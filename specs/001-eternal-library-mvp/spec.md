# 功能規格書：永恆圖書館 MVP

**功能分支**：`001-eternal-library-mvp`
**建立日期**：2025-12-15
**狀態**：草稿
**輸入**：產品需求規格書 (PRD) v1.0 MVP

## 使用者情境與測試 *(必要)*

### User Story 1 - 錢包連接與身份驗證 (Priority: P1)

身為一位求知者，我希望能夠連接我的 IOTA 錢包，以便在永恆圖書館中建立身份並開始我的旅程。

**為何此優先級**：錢包連接是所有區塊鏈互動的前提，沒有錢包連接，使用者無法進行簽到、抽取或鑄造 NFT 等任何核心功能。

**獨立測試**：可透過成功連接錢包並在介面上顯示錢包地址來完整測試，此功能獨立提供「進入圖書館」的價值。

**驗收情境**：

1. **Given** 使用者首次進入永恆圖書館網站，**When** 點擊「連接錢包」按鈕，**Then** 系統喚起 IOTA 錢包連接介面
2. **Given** 使用者在錢包介面確認連接，**When** 連接成功，**Then** 介面顯示使用者錢包地址（縮寫形式）並解鎖主要功能
3. **Given** 使用者的錢包已連接，**When** 重新進入網站，**Then** 系統自動偵測並重新連接錢包
4. **Given** 使用者想要斷開連接，**When** 點擊「斷開連接」，**Then** 錢包連接中斷並返回初始狀態

---

### User Story 2 - 每日簽到獲得智慧碎片 (Priority: P1)

身為一位求知者，我希望能夠每天在訪客簿上簽名，以便獲得智慧碎片 (MGC) 用於抽取解答之書。

**為何此優先級**：每日簽到是使用者獲得 MGC 的主要途徑，是整個遊戲經濟循環的起點，直接影響使用者回訪率。

**獨立測試**：可透過完成簽到動作並看到 MGC 餘額增加來完整測試，此功能獨立提供「每日互動」的價值。

**驗收情境**：

1. **Given** 使用者錢包已連接且今天尚未簽到，**When** 點擊「在訪客簿上簽名」按鈕，**Then** 獲得 5 個智慧碎片，餘額數字跳動更新並顯示 +5 MGC 動畫
2. **Given** 新使用者第一次簽到，**When** 簽到成功，**Then** 系統建立使用者檔案並顯示歡迎訊息
3. **Given** 使用者已連續簽到多天，**When** 完成今日簽到，**Then** 連續簽到天數加 1 並顯示「已連續簽到 X 天」
4. **Given** 使用者今天已經簽到過，**When** 再次點擊簽到按鈕，**Then** 顯示「今天已經簽到過了，明天再來吧！」，按鈕變為禁用狀態並顯示距離下次可簽到的剩餘時間

---

### User Story 3 - 提問並抽取解答之書 (Priority: P1)

身為一位求知者，我希望能夠提出人生問題並抽取解答之書，以便獲得啟發與指引。

**為何此優先級**：抽取解答之書是產品的核心價值體驗，是使用者消耗 MGC 的主要途徑，直接提供「獲得人生問題解答」的核心價值主張。

**獨立測試**：可透過輸入問題、完成抽取動畫並看到答案卡片來完整測試，此功能獨立提供「問答體驗」的核心價值。

**驗收情境**：

1. **Given** 使用者擁有 ≥10 MGC，**When** 輸入問題並點擊「抽取解答」按鈕，**Then** 系統扣除 10 MGC，播放抽取動畫（書本召喚→旋轉→翻開→答案顯現）
2. **Given** 抽取動畫播放完畢，**When** 答案顯現，**Then** 顯示答案卡片，包含：答案文字（英文 + 中文）、稀有度標籤、使用者的問題、對應稀有度的背景顏色
3. **Given** 使用者 MGC < 10，**When** 點擊抽取按鈕，**Then** 顯示「智慧碎片不足！需要 10 MGC，你目前有 X MGC」並提示「完成每日簽到獲得更多碎片」
4. **Given** 使用者未輸入問題，**When** 點擊抽取按鈕，**Then** 顯示「請先在心中默念你的問題」並將輸入框高亮提示

---

### User Story 4 - 將答案鑄造成 NFT (Priority: P2)

身為一位求知者，我希望能夠將獲得的答案鑄造成 NFT，以便永久保存這次問答體驗在區塊鏈上。

**為何此優先級**：NFT 鑄造是產品差異化價值的體現，讓答案具有永久性和所有權，但需要先有抽取答案的功能才能運作。

**獨立測試**：可透過在獲得答案後點擊鑄造按鈕、完成錢包簽署並看到鑄造成功訊息來完整測試。

**驗收情境**：

1. **Given** 使用者已抽取到答案，**When** 點擊「鑄造 NFT」按鈕，**Then** 喚起錢包簽署介面並顯示「正在鑄造...」載入狀態
2. **Given** 錢包交易確認完成，**When** 鑄造成功，**Then** 顯示成功訊息與慶祝動畫，按鈕變為「已鑄造」（禁用），並顯示 NFT 詳情（ID、區塊鏈連結）
3. **Given** 使用者點擊鑄造，**When** 在錢包介面拒絕簽署，**Then** 顯示「交易已取消」，鑄造按鈕保持可用可重新嘗試
4. **Given** 使用者錢包 Gas 不足，**When** 發起鑄造交易，**Then** 顯示「Gas 費用不足，請充值後再試」並提供充值引導

---

### User Story 5 - 查看我的 NFT 收藏 (Priority: P2)

身為一位求知者，我希望能夠查看我收藏的所有 NFT，以便回顧過去的問答歷程。

**為何此優先級**：收藏功能讓使用者的努力成果有展示和回顧的空間，增強長期黏著度，但需要先有鑄造功能才有內容可展示。

**獨立測試**：可透過進入收藏頁面並看到已鑄造的 NFT 列表來完整測試。

**驗收情境**：

1. **Given** 使用者已鑄造至少 1 個 NFT，**When** 進入「我的收藏」頁面，**Then** 以網格形式展示所有 NFT，每張卡片顯示答案預覽、稀有度標籤、抽取日期，按時間排序（新→舊）
2. **Given** 收藏列表已載入，**When** 點擊任一 NFT 卡片，**Then** 打開詳情彈窗顯示完整資訊（NFT ID、我的問題、答案雙語、稀有度、抽取時間）並提供區塊鏈瀏覽器連結
3. **Given** 使用者尚未鑄造任何 NFT，**When** 進入收藏頁面，**Then** 顯示空狀態插圖與提示「你還沒有收藏任何答案，去抽取你的第一個解答吧！」並提供「前往抽取」按鈕
4. **Given** 使用者擁有多個 NFT，**When** 頁面載入，**Then** 顯示統計卡片（總收藏數、稀有度分佈）

---

### User Story 6 - 查看個人統計 (Priority: P3)

身為一位求知者，我希望能夠查看我的圖書館活動統計，以便了解自己的參與程度。

**為何此優先級**：統計功能增強使用者的成就感和進度追蹤，屬於錦上添花功能，可在核心功能完成後實作。

**獨立測試**：可透過進入統計頁面並看到各項數據來完整測試。

**驗收情境**：

1. **Given** 使用者已有活動記錄，**When** 進入統計頁面，**Then** 顯示連續簽到天數、累積簽到總數、總抽取次數、當前 MGC 餘額、NFT 收藏數量
2. **Given** 統計數據載入中，**When** 數字開始顯示，**Then** 重要數字有動態計數動畫效果

---

### 邊界情況

- 當使用者在抽取動畫進行中關閉頁面時，系統如何處理已扣除的 MGC？
- 當使用者在 NFT 鑄造過程中網路中斷時，系統如何確保交易狀態的正確性？
- 當使用者的錢包連接逾時時，系統應如何提示並允許重新連接？
- 當同一使用者從多個裝置同時登入時，MGC 餘額如何同步？
- 當答案庫中某個稀有度類別的答案全部被抽取過時，系統如何處理重複問題？

## 需求 *(必要)*

### 功能需求

**錢包與身份**

- **FR-001**：系統必須支援 IOTA 錢包連接以驗證使用者身份
- **FR-002**：系統必須在錢包連接成功後顯示縮寫形式的錢包地址
- **FR-003**：系統必須支援使用者主動斷開錢包連接

**每日簽到**

- **FR-004**：系統必須允許已連接錢包的使用者每 24 小時簽到一次
- **FR-005**：系統必須在簽到成功時發放固定 5 個 MGC 給使用者
- **FR-006**：系統必須記錄並顯示使用者的連續簽到天數
- **FR-007**：系統必須在使用者今日已簽到時禁用簽到按鈕並顯示倒計時

**抽取解答**

- **FR-008**：系統必須允許使用者輸入任意文字作為問題
- **FR-009**：系統必須在抽取時扣除固定 10 MGC
- **FR-010**：系統必須從 50 個預設答案中依稀有度機率隨機抽取一個答案
- **FR-011**：系統必須以雙語（英文 + 中文）顯示答案內容
- **FR-012**：系統必須根據答案稀有度顯示對應的視覺樣式（Common 灰、Rare 藍、Epic 紫、Legendary 金）
- **FR-013**：系統必須在 MGC 不足時阻止抽取並顯示適當提示

**NFT 鑄造**

- **FR-014**：系統必須允許使用者將已抽取的答案鑄造成 NFT
- **FR-015**：系統必須確保每個答案只能被同一使用者鑄造一次
- **FR-016**：NFT 必須包含以下 metadata：答案文字（雙語）、使用者問題、稀有度、答案編號、抽取時間戳
- **FR-017**：系統必須在鑄造成功後顯示 NFT 詳情與區塊鏈瀏覽器連結

**收藏展示**

- **FR-018**：系統必須以網格佈局展示使用者的所有 NFT 收藏
- **FR-019**：系統必須支援點擊 NFT 卡片查看完整詳情
- **FR-020**：系統必須顯示收藏統計（總數、稀有度分佈）
- **FR-021**：系統必須提供響應式網格佈局（桌面 4 列、平板 3 列、手機 2 列）

**個人統計**

- **FR-022**：系統必須顯示使用者的連續簽到天數、累積簽到總數
- **FR-023**：系統必須顯示使用者的總抽取次數、當前 MGC 餘額
- **FR-024**：系統必須顯示使用者的 NFT 收藏數量

### 關鍵實體

- **使用者 (Seeker)**：錢包地址、MGC 餘額、連續簽到天數、累積簽到次數、總抽取次數、上次簽到時間
- **智慧碎片 (MGC)**：應用內積分，不可交易，用於抽取解答
- **答案 (Answer)**：編號、英文內容、中文內容、稀有度（Common/Rare/Epic/Legendary）、分類
- **抽取記錄 (DrawRecord)**：關聯使用者、關聯答案、使用者問題、抽取時間、是否已鑄造
- **NFT**：Token ID、關聯抽取記錄、鑄造時間、區塊鏈交易 hash

## 成功標準 *(必要)*

### 可衡量成果

**使用者體驗**

- **SC-001**：新使用者在 5 分鐘內完成首次簽到並理解核心玩法
- **SC-002**：使用者完成每日簽到的時間不超過 30 秒
- **SC-003**：使用者從輸入問題到看到答案的完整體驗不超過 1 分鐘（含動畫）
- **SC-004**：90% 的使用者在首次使用時成功完成主要任務（簽到或抽取）

**系統效能**

- **SC-005**：首頁載入時間不超過 3 秒
- **SC-006**：簽到操作響應時間不超過 1 秒
- **SC-007**：錢包連接成功率達 95% 以上
- **SC-008**：抽取動畫播放流暢，無明顯卡頓

**業務指標**

- **SC-009**：連續簽到 7 天的使用者比例達 50%
- **SC-010**：連續簽到 30 天的使用者比例達 20%
- **SC-011**：累積鑄造 10 個 NFT 的使用者比例達 30%

## 假設

- IOTA 區塊鏈網路穩定可用，Gas 費用在合理範圍內
- 使用者已安裝支援 IOTA 的錢包擴充功能
- 50 個預設答案已準備完成並分配好稀有度
- 稀有度機率分佈：Common 60%、Rare 30%、Epic 8%、Legendary 2%
- 每次簽到獎勵固定為 5 MGC，每次抽取消耗固定為 10 MGC
- NFT 鑄造僅需支付 Gas 費用，無額外費用
- 使用者可以重複抽取到相同的答案
