<!--
同步影響報告：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
版本變更：[TEMPLATE] → 1.1.0
變更類型：MAJOR（初始憲章建立）
日期：2025-12-10

修改的原則：
  ✓ I. 程式碼品質 — 新增：SOLID 原則、型別安全、錯誤處理要求
  ✓ II. 測試紀律 — 新增：TDD 強制性、紅-綠-重構、覆蓋率要求
  ✓ III. 使用者體驗一致性 — 新增：回饋、無障礙、響應式設計
  ✓ IV. 效能標準 — 新增：回應時間、套件大小、監控要求
  ✓ V. 文件語言 — 新增：繁體中文（zh-TW）要求

新增章節：
  ✓ 技術標準 — 程式碼風格、格式化、Python PEP 8、相依性管理
  ✓ 開發工作流程 — Git 工作流程、程式碼審查、CI、功能旗標
  ✓ 治理 — 修訂流程、版本控制政策、合規性、執行

需要更新的模板：
  ⚠ .specify/templates/plan-template.md
     → 憲章檢查章節存在（第 30-34 行）
     → 與新原則對齊（品質、測試、使用者體驗、效能、文件）
     → 語言：需依原則 V 更新為繁體中文

  ⚠ .specify/templates/spec-template.md
     → 使用者情境結構支援測試紀律原則
     → 需求章節支援程式碼品質和效能原則
     → 語言：需依原則 V 更新為繁體中文

  ⚠ .specify/templates/tasks-template.md
     → 任務組織支援 TDD 工作流程（測試先於實作）
     → 階段結構與品質關卡對齊
     → 語言：需依原則 V 更新為繁體中文

後續待辦事項：
  ⚠ spec-template.md：將所有佔位符文字更新為繁體中文
  ⚠ tasks-template.md：將所有佔位符文字更新為繁體中文
  ⚠ plan-template.md：將所有佔位符文字更新為繁體中文
  ⚠ 依原則 V 建立/更新專案 README.md 為繁體中文
  ⚠ 檢查 .specify/ 中所有現有 .md 檔案的語言合規性
  ✓ constitution_zh-tw.md：已建立為繁體中文版本

相依產物狀態：
  ✓ plan-template.md 中的憲章檢查：相容
  ✓ tasks-template.md 中的測試優先工作流程：相容
  ⚠ 文件語言：模板需要繁體中文翻譯

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
-->

# 專案憲章

## 核心原則

### I. 程式碼品質

**不可妥協** — 所有程式碼在合併前必須符合以下品質標準：

- **可讀性優先** — 程式碼是為人類閱讀和維護而編寫的。清晰、自我說明的程式碼及有意義的命名優先於巧妙的解決方案。
- **SOLID 原則** — 遵循單一職責、開放封閉、里氏替換、介面隔離和依賴反轉原則。
- **審慎的 DRY** — 在有價值的地方消除重複，但避免過早抽象。「三次法則」：重複一次可接受，第三次出現時進行重構。
- **型別安全** — 在可用的情況下使用強型別。所有公開介面必須具有明確的型別註解或簽名。
- **錯誤處理** — 所有錯誤路徑必須是明確的。不允許靜默失敗；錯誤必須攜帶可操作的上下文資訊。

**理由**：品質負債會以指數方式累積。在建立時強制執行標準比後續補救便宜 10 倍。

### II. 測試紀律

**不可妥協** — 測試驅動開發（TDD）對所有新功能和錯誤修復是強制性的。

**紅-綠-重構循環**：

- **紅色** – 先編寫失敗的測試
- **綠色** – 編寫最小程式碼使測試通過
- **重構** – 在保持測試通過的情況下改進程式碼

**測試要求**：

- **合約測試** — 公開 API/函式庫/服務邊界必須具備
- **整合測試** — 跨元件互動和關鍵使用者旅程必須具備
- **單元測試** — 複雜的業務邏輯和邊界情況必須具備
- **覆蓋率** ≥ 80% 新程式碼；關鍵路徑 100%
- **獨立性** — 每個測試必須能獨立執行
- **效能** — 單元測試 < 100ms，整合測試 < 5s

**理由**：先編寫的測試定義意圖並保護重構。測試 = 活的規格書。

### III. 使用者體驗一致性

**不可妥協** — 所有面向使用者的功能必須表現一致。

**使用者體驗原則**：

- **回饋** — 每個操作都獲得即時的視覺/文字/觸覺回應
- **錯誤訊息** — 可操作且非技術性（發生了什麼、為什麼、該怎麼做）
- **載入狀態** — 如果操作 > 200ms 則顯示指示器
- **無障礙** — 必須符合 WCAG 2.1 AA（鍵盤、螢幕閱讀器、對比度）
- **響應式設計** — 在所有目標設備和尺寸上可用
- **一致性** — UI 模式和術語必須統一
- **漸進式揭露** — 先展示核心功能；在需要時才顯示複雜性

**理由**：不一致會侵蝕信任並增加認知負擔。

### IV. 效能標準

**不可妥協** — 效能是功能，不是階段。

**要求**：

- **回應時間** < 100ms（感知即時）
- **頁面載入** < 3s（一般網路環境）
- **TTI**（可互動時間）< 3s
- **API 延遲** p95 < 200ms
- **資料庫查詢** — 無 N+1；使用索引
- **記憶體** < 200MB（客戶端）
- **套件大小**：
  - **關鍵路徑** < 100KB gzipped（首頁可互動所需）
  - **首頁總計** < 500KB gzipped（不含懶載入模組）
  - **完整應用** < 1MB gzipped（含所有懶載入模組）
  - **懶載入模組** — 非首頁關鍵功能應使用動態載入

**監控**：

- **基準測試** — 關鍵路徑必須具備
- **效能分析** 優化前先進行（「測量，不要猜測」）
- **回歸測試** 在 CI/CD 中
- **RUM** — 生產環境中的真實使用者監控

**理由**：低劣的效能是持續影響所有使用者的錯誤。

### V. 文件語言

**不可妥協** — 所有專案文件必須使用繁體中文（zh-TW）編寫。

**語言要求**：

- **規格書** — spec.md 檔案必須使用繁體中文
- **計畫** — plan.md、research.md、data-model.md 等必須使用繁體中文
- **任務** — tasks.md 必須使用繁體中文
- **分析文件** — analyze.md、analysis.md、data-analyze.md 及所有分析相關的 Markdown 檔案必須使用繁體中文
- **使用者文件** — README、快速入門和 API 指南必須使用繁體中文
- **程式碼註解** — 公開 API 文件字串應使用繁體中文
- **提交訊息** — 可使用英文以利全球協作，但偏好中文
- **憲章例外** — 此檔案保留英文作為治理參考

**理由**：繁體中文是利害關係人和使用者的主要語言。母語文件可提高清晰度並減少溝通錯誤。英文憲章保留與國際工具的相容性。

## 技術標準

### 程式碼風格與格式化

- **程式碼檢查** — 所有程式碼必須以零警告通過
- **格式化** — 僅使用自動化工具（Prettier、Black、rustfmt 等）
- **Python 程式碼風格** — 所有 Python 程式碼必須符合 PEP 8
- **預提交勾點** — 必須用於程式碼檢查、格式化和本地測試
- **行長度** ≤ 100 字元
- **註解** — 解釋為什麼，而不是什麼；程式碼應該是自我說明的

### 文件

- **公開 API** — 必須具備含範例的完整文件
- **README** — 必須包含設定、使用和貢獻指南
- **架構決策** — 必須記錄主要設計理由
- **內嵌文件** — 複雜邏輯需要解釋性註解
- **變更日誌** — 所有版本必須使用語意化版本控制

### 相依性管理

- **最小相依性** — 每個相依性都必須有正當理由；偏好標準函式庫
- **安全性** — 採用前掃描並定期更新
- **版本控制** — 固定主要/次要版本；提交鎖定檔案
- **授權相容性** — 所有相依性必須授權相容

## 開發工作流程

### Git 工作流程

- **分支命名**：`<類型>/<票號>-<簡述>`（例如 `feature/123-user-auth`）
- **約定式提交** 訊息為必要
- 僅 **原子提交**
- **禁止直接提交** 到 main；需要 PR
- **受保護的分支** 需要通過 CI 和審查

### 程式碼審查

- **≥ 1 個核准** 來自擁有者；架構變更需要 2 個
- **審查範圍** 包括正確性、測試、文件、效能、安全性
- **回應時間** ≤ 24h
- 僅 **建設性回饋** — 專注於程式碼，而非人
- **PR < 400 行** 為佳；拆分大型 PR

### 持續整合

- 所有測試必須通過
- 建置必須在所有目標上成功
- 程式碼檢查和格式檢查必須通過
- 安全掃描必須通過
- 效能不可退化
- CI 持續時間 < 10 分鐘

### 功能旗標

- 未完成的功能置於旗標後
- 建議漸進式推出
- 關鍵功能需要終止開關
- 完全推出後兩個衝刺內移除旗標

## 治理

### 修訂流程

1. **提案** — 記錄變更及其理由和影響
2. **審查** — 技術負責人評估影響
3. **核准** — 需要維護者共識
4. **遷移** — 提供合規指南和時間表
5. **版本升級** — 依語意化版本控制遞增

### 版本控制政策

- **MAJOR** — 破壞性治理變更
- **MINOR** — 新原則或擴展章節
- **PATCH** — 澄清或非語意性編輯

### 合規性

- **PR 驗證** — 所有 PR 必須證明合規
- **計畫檢查** — 實作計畫必須驗證憲章對齊
- **例外** — 在 plan.md 中記錄任何違規並附上理由
- **定期審查** — 每季審查相關性和有效性

### 執行

- **自動化** — 盡可能使用程式碼檢查器、CI 檢查和勾點
- **程式碼審查** — 審查者必須阻擋不合規的變更
- **回顧** — 公開追蹤和討論違規
- **活的文件** — 憲章隨團隊需求演進

**版本**：1.2.0 | **批准日期**：2025-11-18 | **最後修訂**：2025-12-16
